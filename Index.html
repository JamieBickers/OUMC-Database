<head>
    <link rel="stylesheet" href="style.css">
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
</head>

<div class="input-group">
    <h1>Membership Form</h1>

    <div>
        <button class="btn hidden" id="Database">Database</button>
        <button class="btn" id="upgradeTermMembers">Upgrade Term Members</button>
    </div>
    <br>

    <form id="memberForm">
        <div class="input-wrapper">First Name <input id="first-name-input" class="input-sm"/></div>
        <div class="input-wrapper">Surname <input id="surname-input" class="input-sm"/></div>
        <div class="input-wrapper">Date of Birth <input type="text" id="dob-input" class="input-sm"
                                                        placeholder="DD/MM/YYYY"/></div>
        <div class="input-wrapper">
            Affiliation
            <div class="select-wrapper">
                <select id="affiliation-input" class="input-sm">
                    <option value="">(Please Select)</option>
                    <option value="Student">Student</option>
                    <option value="Staff">Staff</option>
                    <option value="External">External</option>
                </select>
            </div>
        </div>
        <div class="input-wrapper">
            If student OSS number
            <input id="OSS-number-input" class="input-sm"/></div>
        </p>

        <div class="input-wrapper">
            College
            <div class="select-wrapper">
                <select id="college-input" class="input-sm">
                    <option value="">(Please Select)</option>
                    <option value="None">None</option>
                    <option value="Balliol College">Balliol College</option>
                    <option value="Blackfriars">Blackfriars</option>
                    <option value="Brasenose CollegeC">Brasenose CollegeC</option>
                    <option value="Campion Hall GS">Campion Hall GS</option>
                    <option value="Christ Church">Christ Church</option>
                    <option value="Corpus Christi College">Corpus Christi College</option>
                    <option value="Exeter College">Exeter College</option>
                    <option value="Green Templeton College">Green Templeton College</option>
                    <option value="Harris Manchester College">Harris Manchester College</option>
                    <option value="Hertford College">Hertford College</option>
                    <option value="Jesus College">Jesus College</option>
                    <option value="Keble College">Keble College</option>
                    <option value="Kellogg College">Kellogg College</option>
                    <option value="Lady Margaret Hall">Lady Margaret Hall</option>
                    <option value="Linacre College">Linacre College</option>
                    <option value="Lincoln College">Lincoln College</option>
                    <option value="Magdalen College">Magdalen College</option>
                    <option value="Mansfield College">Mansfield College</option>
                    <option value="Merton College">Merton College</option>
                    <option value="New College">New College</option>
                    <option value="Nuffield College">Nuffield College</option>
                    <option value="Oriel College">Oriel College</option>
                    <option value="Pembroke College">Pembroke College</option>
                    <option value="The Queen's College">The Queen's College</option>
                    <option value="Regent's Park College">Regent's Park College</option>
                    <option value="Somerville College">Somerville College</option>
                    <option value="St Anne's College">St Anne's College</option>
                    <option value="St Antony's College">St Antony's College</option>
                    <option value="St Benet's Hall">St Benet's Hall</option>
                    <option value="St Catherine's College">St Catherine's College</option>
                    <option value="St Cross College">St Cross College</option>
                    <option value="St Edmund Hall">St Edmund Hall</option>
                    <option value="St Hilda's College">St Hilda's College</option>
                    <option value="St Hugh's College">St Hugh's College</option>
                    <option value="St John's College">St John's College</option>
                    <option value="St Peter's College">St Peter's College</option>
                    <option value="St Stephen's House">St Stephen's House</option>
                    <option value="Trinity College">Trinity College</option>
                    <option value="University College">University College</option>
                    <option value="Wadham College">Wadham College</option>
                    <option value="Wolfson College">Wolfson College</option>
                    <option value="Worcester College">Worcester College</option>
                    <option value="Wycliffe Hall">Wycliffe Hall</option>
                </select>
            </div>
        </div>
        <div class="input-wrapper">Phone Number <input id="phone-number-input" class="input-sm"/></div>
        <div class="input-wrapper">Address 1 <input id="address-1-input" class="input-sm"/></div>
        <div class="input-wrapper">Address 2 <input id="address-2-input" class="input-sm"/></div>
        <div class="input-wrapper">Town <input id="town-input" class="input-sm"/></div>
        <div class="input-wrapper">County <input id="county-input" class="input-sm"/></div>
        <div class="input-wrapper">Postcode <input id="postcode-input" class="input-sm"/></div>
        <div class="input-wrapper">Email <input id="email-input" type="email" class="input-sm"></div>
        <div class="input-wrapper">Emergency Contact Name <input id="emergency-contact-name-input" class="input-sm"/></div>
        <div class="input-wrapper">Emergency Contact Phone Number <input id="emergency-contact-phone-number-input" class="input-sm"/></div>

        <div class="input-wrapper">
            Membership Type
            <div class="select-wrapper">
                <select id="membership-type-input" class="input-sm">
                    <option value=""> (Please Select)</option>
                    <option value="Annual"> Annual</option>
                    <option value="Life"> Annual - Life Member Form</option>
                    <option value="Michaelmas"> Term - Michaelmas - Expires 31st December</option>
                    <option value="Hilary"> Term - Hilary - Expires 31st March</option>
                    <option value="Trinity"> Term - Trinity - Expires 30th June</option>
                    <option value="Summer"> Term - Summer - From 01/07 to 30/09</option>
                </select>
            </div>
        </div>

        <div class="input-wrapper">Date on paper form <input type="text" id="date-on-form-input" class="input-sm"
                                                             placeholder="DD/MM/YYYY"/></div>
        <div class="input-wrapper">Form authorised By <input id="authorised-by-input" class="input-sm"/></div>
        <div class="input-wrapper">This web form submitted By <input id="submitted-by-input" class="input-sm"/></div>
        <button id="submit" class="btn">Submit</button>
    </form>
</div>
<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
<script src="./site.js"></script>
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
<script>
    const database = firebaseInit();
    const provider = authenticationProviderInit();

    registerAuthChecking(
        function () {
			showDatabaseLinkButton();
			showForm();
		},
        showForm,
		function () {
			showDatabaseLinkButton();
			showForm();
		},
        function () {
            signInWithRedirect(emptyFunction);
        });

    document.getElementById("submit").onclick = function (e) {
        e.preventDefault();
        clearErrors();

        //coded for simplicity, not efficiency
        var firstName = document.getElementById("first-name-input").value;
        var surname = document.getElementById("surname-input").value;
        var dob = document.getElementById("dob-input").value;
        var affiliation = document.getElementById("affiliation-input").value;
        var college = document.getElementById("college-input").value;
        var phoneNumber = document.getElementById("phone-number-input").value;
        var address1 = document.getElementById("address-1-input").value;
        var address2 = document.getElementById("address-2-input").value;
        var town = document.getElementById("town-input").value;
        var county = document.getElementById("county-input").value;
        var postcode = document.getElementById("postcode-input").value;
        var email = document.getElementById("email-input").value;
        var emergancyContactName = document.getElementById("emergency-contact-name-input").value;
        var emergancyContactPhoneNumber = document.getElementById("emergency-contact-phone-number-input").value;
        var membershipType = document.getElementById("membership-type-input").value;
        var dateOnForm = document.getElementById("date-on-form-input").value;
        var authorisedBy = document.getElementById("authorised-by-input").value;
        var submittedBy = document.getElementById("submitted-by-input").value;
        var ossNumber = document.getElementById("OSS-number-input").value;

        var isValid = true;
        if (!processTextInput(firstName, 'first-name-input')) {
            isValid = false;
        }
        if (!processTextInput(surname, 'surname-input')) {
            isValid = false;
        }
        var dob = processDateInput(dob, 'dob-input');
        if (!dob) {
            isValid = false;
        }
        if (!processTextInput(affiliation, 'affiliation-input')) {
            isValid = false;
        }
        if (!processTextInput(college, 'college-input')) {
            isValid = false;
        }
        if (!processTextInput(phoneNumber, 'phone-number-input')) {
            isValid = false;
        }
        if (!processTextInput(address1, 'address-1-input')) {
            isValid = false;
        }
        //not required
        // if (!processTextInput(address2, 'address-2-input')) {
        //     isValid = false;
        // }
        if (!processTextInput(town, 'town-input')) {
            isValid = false;
        }
        //not required
        // if (!processTextInput(county, 'county-input')) {
        //     isValid = false;
        // }
        if (!processTextInput(postcode, 'postcode-input')) {
            isValid = false;
        }
        if (!processTextInput(email, 'email-input')) {
            isValid = false;
        }
        if (!processTextInput(emergancyContactName, 'emergency-contact-name-input')) {
            isValid = false;
        }
        if (!processTextInput(emergancyContactPhoneNumber, 'emergency-contact-phone-number-input')) {
            isValid = false;
        }
        if (!processTextInput(membershipType, 'membership-type-input')) {
            isValid = false;
        }
        dateOnForm = processDateInput(dateOnForm, 'date-on-form-input');
        if (!dateOnForm) {
            isValid = false;
        }
        if (!processTextInput(authorisedBy, 'authorised-by-input')) {
            isValid = false;
        }
        if (!processTextInput(submittedBy, 'submitted-by-input')) {
            isValid = false;
        }
        //not required
        // if (!processTextInput(ossNumber, 'OSS-number-input')) {
        //     isValid = false;
        // }

        if (isValid) {
            firebase.database().ref(membersTableRoot).push({
                firstName: firstName,
                surname: surname,
                dob: dob,
                affiliation: affiliation,
                college: college,
                phoneNumber: phoneNumber,
                address1: address1,
                address2: address2,
                town: town,
                county: county,
                postcode: postcode,
                email: email,
                emergancyContactName: emergancyContactName,
                emergancyContactPhoneNumber: emergancyContactPhoneNumber,
                membershipType: membershipType,
                dateOnForm: dateOnForm,
                authorisedBy: authorisedBy,
                submittedBy: submittedBy,
                timestamp: Date.now(),
                ossNumber: ossNumber
            }).then(function () {
                window.location.href = successLocation + "?from=add";
            }).catch(function () {
                window.location.href = errorLocation;
            });
        }

    };

    document.getElementById("Database").onclick = function () {
        window.location.href = viewMembersLocation;
    };

    document.getElementById("upgradeTermMembers").onclick = function () {
        window.location.href = upgradeTermMembersLocation;
    };

    function showDatabaseLinkButton() {
        let databaseButton = document.getElementById("Database");
        databaseButton.classList.remove("hidden");
    }
</script>